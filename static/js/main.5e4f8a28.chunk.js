(this.webpackJsonpperview=this.webpackJsonpperview||[]).push([[0],{12:function(e,t,n){e.exports=n(21)},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var o=n(6),r=n.n(o),a=n(10),i=n.n(a),c=(n(19),n(11)),s=n(0),l=n(2),u=n(3),v=n(4),d=function(e){Object(v.a)(Position,e);var t=Object(u.a)(Position);function Position(){var e;Object(s.a)(this,Position);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).x=0,e.y=0,e}return Position}(l.a);d.schema={x:{type:l.d.Number},y:{type:l.d.Number}};var f=d,p=function(e){Object(v.a)(Renderable,e);var t=Object(u.a)(Renderable);function Renderable(){return Object(s.a)(this,Renderable),t.apply(this,arguments)}return Renderable}(l.c),h=n(1),m=function(e){Object(v.a)(Selectable,e);var t=Object(u.a)(Selectable);function Selectable(){var e;Object(s.a)(this,Selectable);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).selected=!1,e.toggle=function(){e.selected=!e.selected},e}return Selectable}(l.a);m.schema={selected:{type:l.d.Boolean}};var b=m,g=function(e){Object(v.a)(Renderer,e);var t=Object(u.a)(Renderer);function Renderer(e,n){var o,r=n.canvas,a=n.priority;return Object(s.a)(this,Renderer),(o=t.call(this,e,{priority:a})).canvas=void 0,o.clear=function(){var e=o.canvas.getContext("2d");e&&e.clearRect(0,0,o.canvas.width,o.canvas.height)},o.drawCircle=function(e){var t=e.x,n=e.y,r=e.selected,a=o.canvas.getContext("2d");a&&(a.fillStyle="#888",a.beginPath(),a.arc(t,n,10,0,2*Math.PI,!1),a.fill(),a.lineWidth=1,a.strokeStyle=r?"#F22":"#222",a.stroke())},o.canvas=r,o}return Object(h.a)(Renderer,[{key:"execute",value:function execute(e,t){var n=this;this.clear(),this.queries.renderables.results.forEach((function(e){var t,o=e.getComponent(f),r=o.x,a=o.y,i=(null!==(t=e.getComponent(b))&&void 0!==t?t:{selected:!1}).selected;n.drawCircle({x:r,y:a,selected:i})}))}}]),Renderer}(l.b);g.queries={renderables:{components:[p,f]}};var y=g,w=function(e){Object(v.a)(SelectionToggler,e);var t=Object(u.a)(SelectionToggler);function SelectionToggler(){var e;Object(s.a)(this,SelectionToggler);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onMouseDown=function(t){if(0===t.button){var n=t.clientX,o=t.clientY;e.queries.selectables.results.forEach((function(e){var t=e.getComponent(f),r=t.x,a=t.y,i=r-n,c=a-o;Math.sqrt(i*i+c*c)<=10&&e.getMutableComponent(b).toggle()}))}},e}return Object(h.a)(SelectionToggler,[{key:"execute",value:function execute(e,t){}}]),SelectionToggler}(l.b);w.queries={selectables:{components:[b,f]}};var x=w,M=function(e){Object(v.a)(Moveable,e);var t=Object(u.a)(Moveable);function Moveable(){var e;Object(s.a)(this,Moveable);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).hasDestination=!1,e.destinationX=0,e.destinationY=0,e.speed=100,e}return Moveable}(l.a);M.schema={hasDestination:{type:l.d.Boolean},destinationX:{type:l.d.Number},destinationY:{type:l.d.Number},speed:{type:l.d.Number}};var j=M,C=function positionsAreClose(e,t,n){var o=e.x-t.x,r=e.y-t.y;return Math.sqrt(o*o+r*r)<=n},O=function(e){Object(v.a)(Mover,e);var t=Object(u.a)(Mover);function Mover(){var e;Object(s.a)(this,Mover);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onMouseDown=function(t){if(2===t.button){var n=t.clientX,o=t.clientY;e.selected().forEach((function(e){var t=e.getMutableComponent(j);t.hasDestination=!0,t.destinationX=n,t.destinationY=o}))}},e.selected=function(){return e.queries.selectables.results.filter((function(e){return e.getComponent(b).selected}))},e.withDestination=function(){return e.queries.moveables.results.filter((function(e){return e.getComponent(j).hasDestination}))},e}return Object(h.a)(Mover,[{key:"execute",value:function execute(e,t){this.withDestination().forEach((function(t){var n=t.getMutableComponent(f),o=t.getComponent(j),r=o.destinationX,a=o.destinationY,i=o.speed,c={x:r,y:a},s=function unitVector(e){var t=e.x,n=e.y,o=Math.sqrt(t*t+n*n);return{x:t/o,y:n/o}}({x:c.x-n.x,y:c.y-n.y}),l=s.x*(e*i/1e3),u=s.y*(e*i/1e3);n.x+=l,n.y+=u,C(n,c,1)&&(t.getMutableComponent(j).hasDestination=!1)}))}}]),Mover}(l.b);O.queries={moveables:{components:[j,f]},selectables:{components:[j,b]}};var S=O,q=function(e){Object(v.a)(Stopper,e);var t=Object(u.a)(Stopper);function Stopper(){var e;Object(s.a)(this,Stopper);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).stopIfColliding=function(t){var n=t.getComponent(f);e.queries.moveables.results.forEach((function(e){if(t!==e){var o=e.getComponent(f);C(n,o,10)&&(t.getMutableComponent(j).hasDestination=!1)}}))},e}return Object(h.a)(Stopper,[{key:"execute",value:function execute(e,t){this.queries.moveables.results.forEach(this.stopIfColliding)}}]),Stopper}(l.b);q.queries={moveables:{components:[j,f]}};var R=q,D=function Game(e){var t=this,n=e.canvas;Object(s.a)(this,Game),this.world=void 0,this.canvas=void 0,this.lastTime=void 0,this.animationFrameRequest=void 0,this.start=function(){for(var e=0;e<10;e++)t.world.createEntity().addComponent(f,{x:50*e,y:50*e}).addComponent(b).addComponent(j).addComponent(p);t.run()},this.stop=function(){t.animationFrameRequest&&cancelAnimationFrame(t.animationFrameRequest)},this.onMouseDown=function(e){var n=t.world.getSystem(S),o=t.world.getSystem(x);n.onMouseDown(e),o.onMouseDown(e)},this.run=function(){var e=performance.now(),n=e-t.lastTime;t.world.execute(n,e),t.lastTime=e,t.animationFrameRequest=requestAnimationFrame(t.run)},this.canvas=n,this.lastTime=performance.now(),this.animationFrameRequest=null,this.world=(new l.e).registerSystem(y,{canvas:n}).registerSystem(x).registerSystem(S).registerSystem(R).registerComponent(f).registerComponent(b).registerComponent(j).registerComponent(p)},E=(n(20),function App(){var e=r.a.useState(null),t=Object(c.a)(e,2),n=t[0],o=t[1],a=r.a.useRef(null);r.a.useEffect((function(){if(n)return a.current=new D({canvas:n}),a.current.start(),function(){var e;null===(e=a.current)||void 0===e||e.stop(),a.current=null}}),[n]),r.a.useEffect((function(){var e=function handleResize(){n&&(n.width=window.innerWidth,n.height=window.innerHeight)};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[n]);return r.a.createElement("div",{className:"App"},r.a.createElement("canvas",{ref:o,onMouseDown:function onMouseDown(e){var t;e.preventDefault(),e.stopPropagation(),null===(t=a.current)||void 0===t||t.onMouseDown(e)},onContextMenu:function onContextMenu(e){return e.preventDefault()}}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(E,null)),document.getElementById("root")),function unregister(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}()}},[[12,1,2]]]);
//# sourceMappingURL=main.5e4f8a28.chunk.js.map