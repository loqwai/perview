(this.webpackJsonpperview=this.webpackJsonpperview||[]).push([[0],{12:function(e,t,n){e.exports=n(21)},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var o=n(6),r=n.n(o),i=n(10),a=n.n(i),c=(n(19),n(11)),s=n(0),l=n(2),u=n(3),v=n(4),f=n(1),p=function(){function Vector2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(s.a)(this,Vector2),this.x=void 0,this.y=void 0,this.x=e,this.y=t}return Object(f.a)(Vector2,[{key:"set",value:function set(e,t){return this.x=e,this.y=t,this}},{key:"copy",value:function copy(e){return this.x=e.x,this.y=e.y,this}},{key:"clone",value:function clone(){return new Vector2(this.x,this.y)}}]),Vector2}(),h=p,d=Object(l.g)({name:"Vector2",default:new p,copy:l.f,clone:l.e}),g=function(e){Object(v.a)(Circle,e);var t=Object(u.a)(Circle);function Circle(){var e;Object(s.a)(this,Circle);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).position=new h,e.radius=0,e}return Circle}(l.a);g.schema={position:{type:d},radius:{type:l.c.Number}};var m=g,y=function(e){Object(v.a)(Selectable,e);var t=Object(u.a)(Selectable);function Selectable(){var e;Object(s.a)(this,Selectable);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).selected=!1,e.toggle=function(){e.selected=!e.selected},e}return Selectable}(l.a);y.schema={selected:{type:l.c.Boolean}};var b=y,w=function(e){Object(v.a)(RectangleSelection,e);var t=Object(u.a)(RectangleSelection);function RectangleSelection(){var e;Object(s.a)(this,RectangleSelection);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).startPosition=new h,e.endPosition=new h,e}return RectangleSelection}(l.a);w.schema={startPosition:{type:d},endPosition:{type:d}};var M=w,S=function(e){Object(v.a)(Renderer,e);var t=Object(u.a)(Renderer);function Renderer(e,n){var o,r=n.canvas,i=n.priority;return Object(s.a)(this,Renderer),(o=t.call(this,e,{priority:i})).canvas=void 0,o.ctx=void 0,o.clear=function(){var e;null===(e=o.ctx)||void 0===e||e.clearRect(0,0,o.canvas.width,o.canvas.height)},o.drawCircle=function(e){if(o.ctx){var t=o.ctx,n=e.getComponent(m),r=n.position,i=n.radius,a=e.getComponent(b).selected,c=r.x,s=r.y;t.fillStyle="#888",t.beginPath(),t.arc(c,s,i,0,2*Math.PI,!1),t.fill(),t.lineWidth=1,t.strokeStyle=a?"#F22":"#222",t.stroke()}},o.drawRectangleSelection=function(e){if(o.ctx){var t=o.ctx,n=e.getComponent(M),r=n.startPosition,i=n.endPosition,a=r.x,c=r.y,s=i.x-a,l=i.y-c;t.lineWidth=1,t.strokeStyle="#2F2",t.strokeRect(a,c,s,l)}},o.canvas=r,o.ctx=o.canvas.getContext("2d"),o}return Object(f.a)(Renderer,[{key:"execute",value:function execute(e,t){this.clear(),this.queries.circles.results.forEach(this.drawCircle),this.queries.rectangleSelections.results.forEach(this.drawRectangleSelection)}}]),Renderer}(l.b);S.queries={circles:{components:[m,b]},rectangleSelections:{components:[M]}};var x=S,C=function positionsAreClose(e,t,n){var o=e.x-t.x,r=e.y-t.y;return Math.sqrt(o*o+r*r)<=n},j=function(e){Object(v.a)(SelectionToggler,e);var t=Object(u.a)(SelectionToggler);function SelectionToggler(){var e;Object(s.a)(this,SelectionToggler);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onMouseDown=function(t){if(0===t.button){var n={x:t.clientX,y:t.clientY};e.toggleCircles(n)}},e.toggleCircles=function(t){e.queries.circles.results.forEach((function(e){var n=e.getComponent(m),o=n.position,r=n.radius;C(t,o,r)&&e.getMutableComponent(b).toggle()}))},e}return Object(f.a)(SelectionToggler,[{key:"execute",value:function execute(e,t){}}]),SelectionToggler}(l.b);j.queries={circles:{components:[b,m]}};var O=j,R=function(e){Object(v.a)(Moveable,e);var t=Object(u.a)(Moveable);function Moveable(){var e;Object(s.a)(this,Moveable);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).hasDestination=!1,e.destination=new h,e.speed=100,e}return Moveable}(l.a);R.schema={hasDestination:{type:l.c.Boolean},destination:{type:d},speed:{type:l.c.Number}};var q=R,E=function(e){Object(v.a)(Mover,e);var t=Object(u.a)(Mover);function Mover(){var e;Object(s.a)(this,Mover);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onMouseDown=function(t){if(2===t.button){var n=t.clientX,o=t.clientY;e.selected().forEach((function(e){var t=e.getMutableComponent(q);t.hasDestination=!0,t.destination.set(n,o)}))}},e.selected=function(){return e.queries.selectables.results.filter((function(e){return e.getComponent(b).selected}))},e.withDestination=function(){return e.queries.moveables.results.filter((function(e){return e.getComponent(q).hasDestination}))},e}return Object(f.a)(Mover,[{key:"execute",value:function execute(e,t){this.withDestination().forEach((function(t){var n=t.getMutableComponent(m).position,o=t.getComponent(q),r=o.destination,i=o.speed,a=function unitVector(e){var t=e.x,n=e.y,o=Math.sqrt(t*t+n*n);return{x:t/o,y:n/o}}({x:r.x-n.x,y:r.y-n.y}),c=a.x*(e*i/1e3),s=a.y*(e*i/1e3);n.x+=c,n.y+=s,C(n,r,1)&&(t.getMutableComponent(q).hasDestination=!1)}))}}]),Mover}(l.b);E.queries={moveables:{components:[q,m]},selectables:{components:[q,b]}};var D=E,k=function(e){Object(v.a)(Stopper,e);var t=Object(u.a)(Stopper);function Stopper(){var e;Object(s.a)(this,Stopper);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).stopIfColliding=function(t){var n=t.getComponent(m).position;e.queries.moveables.results.forEach((function(e){if(t!==e){var o=e.getComponent(m).position;C(n,o,20)&&(t.getMutableComponent(q).hasDestination=!1)}}))},e}return Object(f.a)(Stopper,[{key:"execute",value:function execute(e,t){this.queries.moveables.results.forEach(this.stopIfColliding)}}]),Stopper}(l.b);k.queries={moveables:{components:[q,m]}};var P=k,A=function(e){Object(v.a)(RectangleSelector,e);var t=Object(u.a)(RectangleSelector);function RectangleSelector(){var e;Object(s.a)(this,RectangleSelector);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onMouseDown=function(t){if(0===t.button){var n=new h(t.clientX,t.clientY),o=new h(t.clientX,t.clientY);e.world.createEntity().addComponent(M,{startPosition:n,endPosition:o})}},e.onMouseMove=function(t){var n=t.clientX,o=t.clientY;e.queries.rectangleSelections.results.forEach((function(e){var t=e.getComponent(M).endPosition;n!==t.x&&o!==t.y&&e.getMutableComponent(M).endPosition.set(n,o)}))},e.onMouseUp=function(t){0===t.button&&e.queries.rectangleSelections.results.forEach((function(t){var n=t.getComponent(M),o=n.startPosition,r=n.endPosition;t.remove(),e.queries.circles.results.forEach((function(e){var t=e.getComponent(m).position,n=t.x,i=t.y,a=o.x<n&&n<r.x||r.x<n&&n<o.x,c=o.y<i&&i<r.y||r.y<i&&i<o.y;a&&c&&(e.getMutableComponent(b).selected=!0)}))}))},e}return Object(f.a)(RectangleSelector,[{key:"execute",value:function execute(e,t){}}]),RectangleSelector}(l.b);A.queries={circles:{components:[b,m]},rectangleSelections:{components:[M]}};var T=A,F=function Game(e){var t=this,n=e.canvas;Object(s.a)(this,Game),this.world=void 0,this.canvas=void 0,this.lastTime=void 0,this.animationFrameRequest=void 0,this.start=function(){for(var e=0;e<10;e++)t.world.createEntity().addComponent(m,{position:new h(50*e,50*e),radius:10}).addComponent(b).addComponent(q);t.run()},this.stop=function(){t.animationFrameRequest&&cancelAnimationFrame(t.animationFrameRequest)},this.onMouseDown=function(e){var n=t.world.getSystem(D),o=t.world.getSystem(O),r=t.world.getSystem(T);n.onMouseDown(e),o.onMouseDown(e),r.onMouseDown(e)},this.onMouseMove=function(e){t.world.getSystem(T).onMouseMove(e)},this.onMouseUp=function(e){t.world.getSystem(T).onMouseUp(e)},this.run=function(){var e=performance.now(),n=e-t.lastTime;t.world.execute(n,e),t.lastTime=e,t.animationFrameRequest=requestAnimationFrame(t.run)},this.canvas=n,this.lastTime=performance.now(),this.animationFrameRequest=null,this.world=(new l.d).registerSystem(x,{canvas:n}).registerSystem(O).registerSystem(T).registerSystem(D).registerSystem(P).registerComponent(m).registerComponent(b).registerComponent(q).registerComponent(M)},V=(n(20),function App(){var e=r.a.useState(null),t=Object(c.a)(e,2),n=t[0],o=t[1],i=r.a.useRef(null);r.a.useEffect((function(){if(n)return i.current=new F({canvas:n}),i.current.start(),function(){var e;null===(e=i.current)||void 0===e||e.stop(),i.current=null}}),[n]),r.a.useEffect((function(){var e=function handleResize(){n&&(n.width=window.innerWidth,n.height=window.innerHeight)};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[n]);return r.a.createElement("div",{className:"App"},r.a.createElement("canvas",{ref:o,onMouseDown:function onMouseDown(e){var t;e.preventDefault(),e.stopPropagation(),null===(t=i.current)||void 0===t||t.onMouseDown(e)},onMouseMove:function onMouseMove(e){var t;null===(t=i.current)||void 0===t||t.onMouseMove(e)},onMouseUp:function onMouseUp(e){var t;null===(t=i.current)||void 0===t||t.onMouseUp(e)},onContextMenu:function onContextMenu(e){return e.preventDefault()}}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(V,null)),document.getElementById("root")),function unregister(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}()}},[[12,1,2]]]);
//# sourceMappingURL=main.af7ab57e.chunk.js.map