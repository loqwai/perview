(this.webpackJsonpperview=this.webpackJsonpperview||[]).push([[0],{12:function(e,t,n){e.exports=n(21)},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var o=n(6),a=n.n(o),r=n(10),i=n.n(r),c=(n(19),n(11)),s=n(0),l=n(2),u=n(3),d=n(4),v=function(e){Object(d.a)(Position,e);var t=Object(u.a)(Position);function Position(){var e;Object(s.a)(this,Position);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).x=0,e.y=0,e}return Position}(l.a);v.schema={x:{type:l.d.Number},y:{type:l.d.Number}};var m=v,f=function(e){Object(d.a)(Renderable,e);var t=Object(u.a)(Renderable);function Renderable(){return Object(s.a)(this,Renderable),t.apply(this,arguments)}return Renderable}(l.c),h=n(1),b=function(e){Object(d.a)(Selectable,e);var t=Object(u.a)(Selectable);function Selectable(){var e;Object(s.a)(this,Selectable);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).selected=!1,e.toggle=function(){e.selected=!e.selected},e}return Selectable}(l.a);b.schema={selected:{type:l.d.Boolean}};var p=b,g=function(e){Object(d.a)(Renderer,e);var t=Object(u.a)(Renderer);function Renderer(e,n){var o,a=n.canvas,r=n.priority;return Object(s.a)(this,Renderer),(o=t.call(this,e,{priority:r})).canvas=void 0,o.clear=function(){var e=o.canvas.getContext("2d");e&&e.clearRect(0,0,o.canvas.width,o.canvas.height)},o.drawCircle=function(e){var t=e.x,n=e.y,a=e.selected,r=o.canvas.getContext("2d");r&&(r.fillStyle="#888",r.beginPath(),r.arc(t,n,10,0,2*Math.PI,!1),r.fill(),r.lineWidth=1,r.strokeStyle=a?"#F22":"#222",r.stroke())},o.canvas=a,o}return Object(h.a)(Renderer,[{key:"execute",value:function execute(e,t){var n=this;this.clear(),this.queries.renderables.results.forEach((function(e){var t,o=e.getComponent(m),a=o.x,r=o.y,i=(null!==(t=e.getComponent(p))&&void 0!==t?t:{selected:!1}).selected;n.drawCircle({x:a,y:r,selected:i})}))}}]),Renderer}(l.b);g.queries={renderables:{components:[f,m]}};var w=g,y=function(e){Object(d.a)(SelectionToggler,e);var t=Object(u.a)(SelectionToggler);function SelectionToggler(){var e;Object(s.a)(this,SelectionToggler);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).onMouseDown=function(t){if(0===t.button){var n=t.clientX,o=t.clientY;e.queries.selectables.results.forEach((function(e){var t=e.getComponent(m),a=t.x,r=t.y,i=a-n,c=r-o;Math.sqrt(i*i+c*c)<=10&&e.getMutableComponent(p).toggle()}))}},e}return Object(h.a)(SelectionToggler,[{key:"execute",value:function execute(e,t){}}]),SelectionToggler}(l.b);y.queries={selectables:{components:[p,m]}};var C=y,M=function(e){Object(d.a)(Moveable,e);var t=Object(u.a)(Moveable);function Moveable(){var e;Object(s.a)(this,Moveable);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).hasDestination=!1,e.destinationX=0,e.destinationY=0,e.speed=100,e}return Moveable}(l.a);M.schema={hasDestination:{type:l.d.Boolean},destinationX:{type:l.d.Number},destinationY:{type:l.d.Number},speed:{type:l.d.Number}};var j=M,x=function(e){Object(d.a)(MoveCommander,e);var t=Object(u.a)(MoveCommander);function MoveCommander(){var e;Object(s.a)(this,MoveCommander);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).onMouseDown=function(t){if(2===t.button){var n=t.clientX,o=t.clientY;e.selected().forEach((function(e){var t=e.getMutableComponent(j);t.hasDestination=!0,t.destinationX=n,t.destinationY=o}))}},e.selected=function(){return e.queries.selectables.results.filter((function(e){return e.getComponent(p).selected}))},e.withDestination=function(){return e.queries.moveables.results.filter((function(e){return e.getComponent(j).hasDestination}))},e}return Object(h.a)(MoveCommander,[{key:"execute",value:function execute(e,t){this.withDestination().forEach((function(t){var n=t.getMutableComponent(m),o=t.getComponent(j),a=o.destinationX,r=o.destinationY,i=o.speed,c=function unitVector(e){var t=e.x,n=e.y,o=Math.sqrt(t*t+n*n);return{x:t/o,y:n/o}}({x:a-n.x,y:r-n.y}),s=c.x*(e*i/1e3),l=c.y*(e*i/1e3);n.x+=s,n.y+=l;var u=n.x-a,d=n.y-r;Math.sqrt(u*u+d*d)<=1&&(t.getMutableComponent(j).hasDestination=!1)}))}}]),MoveCommander}(l.b);x.queries={moveables:{components:[j,m]},selectables:{components:[j,p]}};var O=x,S=function Game(e){var t=this,n=e.canvas;Object(s.a)(this,Game),this.world=void 0,this.canvas=void 0,this.lastTime=void 0,this.animationFrameRequest=void 0,this.start=function(){for(var e=0;e<10;e++)t.world.createEntity().addComponent(m,{x:50*e,y:50*e}).addComponent(p).addComponent(j).addComponent(f);t.run()},this.stop=function(){t.animationFrameRequest&&cancelAnimationFrame(t.animationFrameRequest)},this.onMouseDown=function(e){var n=t.world.getSystem(O),o=t.world.getSystem(C);n.onMouseDown(e),o.onMouseDown(e)},this.run=function(){var e=performance.now(),n=e-t.lastTime;t.world.execute(n,e),t.lastTime=e,t.animationFrameRequest=requestAnimationFrame(t.run)},this.canvas=n,this.lastTime=performance.now(),this.animationFrameRequest=null,this.world=(new l.e).registerSystem(w,{canvas:n}).registerSystem(C).registerSystem(O).registerComponent(m).registerComponent(p).registerComponent(j).registerComponent(f)},R=(n(20),function App(){var e=a.a.useState(null),t=Object(c.a)(e,2),n=t[0],o=t[1],r=a.a.useRef(null);a.a.useEffect((function(){if(n)return r.current=new S({canvas:n}),r.current.start(),function(){var e;null===(e=r.current)||void 0===e||e.stop(),r.current=null}}),[n]),a.a.useEffect((function(){var e=function handleResize(){n&&(n.width=window.innerWidth,n.height=window.innerHeight)};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[n]);return a.a.createElement("div",{className:"App"},a.a.createElement("canvas",{ref:o,onMouseDown:function onMouseDown(e){var t;e.preventDefault(),e.stopPropagation(),null===(t=r.current)||void 0===t||t.onMouseDown(e)},onContextMenu:function onContextMenu(e){return e.preventDefault()}}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(R,null)),document.getElementById("root")),function unregister(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}()}},[[12,1,2]]]);
//# sourceMappingURL=main.9a2bfd00.chunk.js.map